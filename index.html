<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
(() => {

  /* =======================
        AUTOCOMPLETE DATA
     ======================= */
  const noiCapList = [
    "Công an TP Hồ Chí Minh",
    "Công an Hà Nội",
    "Công an Đồng Nai",
    "Công an Bình Dương",
    "Công an Hải Phòng",
    "Công an Đà Nẵng",
    "Công an Cần Thơ",
    "Cục Cảnh sát QLHC về TTXH",
    "Công an Long An",
    "Công an Bình Thuận",
    "Công an Lâm Đồng",
    "Công an Khánh Hòa",
    "Công an Nghệ An",
    "Công an Thanh Hóa",
    "Công an Tiền Giang",
    "Công an Sóc Trăng"
  ];

  const noicapInput = document.getElementById("noicap");
  const box = document.getElementById("noicapSuggest");

  let activeIndex = -1; // điều hướng phím


  /* =======================
         AUTOCOMPLETE
     ======================= */
  function updateSuggestBox() {
    const keyword = noicapInput.value.trim().toLowerCase();
    if (!keyword) {
      box.style.display = "none";
      return;
    }

    const match = noiCapList
      .filter(x => x.toLowerCase().includes(keyword))
      .slice(0, 5);

    if (match.length === 0) {
      box.style.display = "none";
      return;
    }

    box.innerHTML = "";
    activeIndex = -1;

    match.forEach((item, i) => {
      const div = document.createElement("div");
      div.className = "suggest-item";
      div.textContent = item;

      div.addEventListener("click", () => {
        noicapInput.value = item;
        box.style.display = "none";
      });

      box.appendChild(div);
    });

    box.style.display = "block";
  }


  /* Lắng nghe gõ phím */
  noicapInput.addEventListener("input", updateSuggestBox);

  /* Điều hướng ↑ ↓ Enter */
  noicapInput.addEventListener("keydown", (e) => {
    const items = box.querySelectorAll(".suggest-item");
    if (items.length === 0) return;

    if (e.key === "ArrowDown") {
      e.preventDefault();
      activeIndex = (activeIndex + 1) % items.length;
    }
    else if (e.key === "ArrowUp") {
      e.preventDefault();
      activeIndex = (activeIndex - 1 + items.length) % items.length;
    }
    else if (e.key === "Enter") {
      e.preventDefault();
      if (activeIndex >= 0) {
        noicapInput.value = items[activeIndex].textContent;
        box.style.display = "none";
      }
      return;
    }

    items.forEach((el, i) => {
      el.classList.toggle("active", i === activeIndex);
    });
  });

  /* Ẩn khi click ra ngoài */
  document.addEventListener("click", (e) => {
    if (!noicapInput.contains(e.target) && !box.contains(e.target)) {
      box.style.display = "none";
    }
  });


  /* =======================
        FLATPICKR DATE
     ======================= */
  flatpickr(".flat-date", {
    dateFormat: "d/m/Y",
    allowInput: true
  });


  /* =======================
      HỌ VÀ TÊN TỰ GHÉP
     ======================= */
  const hodem = document.getElementById("hodem");
  const ten = document.getElementById("ten");
  const hoten = document.getElementById("hoten");

  function updateHoten() {
    hoten.value = (hodem.value.trim() + " " + ten.value.trim()).trim();
  }
  hodem.addEventListener("input", updateHoten);
  ten.addEventListener("input", updateHoten);


  /* =======================
       MÃ NV CHỈ CHỮ HOA
     ======================= */
  const manv = document.getElementById("manv");
  manv.addEventListener("input", () => {
    manv.value = manv.value.toUpperCase().replace(/[^A-Z0-9]/g, "");
  });


  /* =======================
         SUBMIT
     ======================= */
  const form = document.getElementById("hrForm");

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    alert("✔ Dữ liệu hợp lệ — Bạn có thể nối phần gửi vào Worker.");
  });

})();
</script>
